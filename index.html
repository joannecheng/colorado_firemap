<!DOCTYPE html>
<head>
  <title>
    Colorado Wildfires
  </title>
  <link rel="stylesheet" type="text/css" href="styles.css" />
</head>
<meta charset="utf-8">
  <body>    
    <div id="content">
    </div>
    <!--script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v0.min.js"></script>  -->

    <script src="vendor/d3.js"></script>
    <script src="vendor/topojson.js"></script>    
    <script>
      var width = 700;
      var height = 700;

      var capitalize = function(str) {
        return str.charAt(0).toUpperCase() + str.slice(1, str.length).toLowerCase();
      }
        //.scale(4700)
      var projection = d3.geo.mercator()
        .scale(80000)
        .center([-105.27, 40.05])
        .translate([width/2, height/2]);

      var path = d3.geo.path()
        .projection(projection);
      
      var svg = d3.select("#content")
        .append("svg")
        .attr('class', 'container')
        .attr("width", width)
        .attr("height", height);
      
      var showTextOnMouseover = function(event, ui) {
        svg.selectAll('text.fire' + ui)
          .attr('display', 'block');
      }

      var hideTextOnMouseover = function(event, ui) {
        svg.selectAll('text.fire' + ui)
          .attr('display', 'none');
      }

      var getYear = function(d){
        var date = d.properties.STARTDATE === null ? d.properties.ENDDATE : d.properties.STARTDATE;
        return date.substr(0,4);
      }

      var infoGraph = function(data) {
        d3.select('#content')
        .append('div')
        .attr('class', 'info')
        .selectAll('.fire-info')
        .data(data.geometries)
        .enter()
        .append('div')
        .attr('class', 'fire-info')
        .text(function(d) { return capitalize(d.properties.NAME) + " " + getYear(d); })
        .on('mouseover', showTextOnMouseover)
        .on('mouseout', hideTextOnMouseover);
      }

      d3.json('topo_boulder_wildfires.json', function(err, data){
        infoGraph(topojson.object(data, data.objects.boulder_wildfires));

        svg.append("path")
          .datum(topojson.object(data, data.objects.boulder_streets))
          .attr('d', path)
          .attr('class', 'states');
          
        svg.selectAll('path.fires')
          .data(topojson.object(data, data.objects.boulder_wildfires).geometries)
          .enter().append('path')
          .attr('d', path)
          .attr('class', function(d, i) { return 'fires fire' + i })
          .on('mouseover', showTextOnMouseover)
          .on('mouseout', hideTextOnMouseover);

        svg.selectAll('text')
          .data(topojson.object(data, data.objects.boulder_wildfires).geometries)
          .enter().append('text')
          .attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"})
          .text(function(d) { return capitalize(d.properties.NAME); })
          .attr('class', function(d, i) { return 'fire' + i })
          .attr('display', 'none')
      });
      
    </script>  
  </body>
</html>
