<!DOCTYPE html>
<head>
  <title>
    Colorado Wildfires
  </title>
  <link rel="stylesheet" type="text/css" href="styles.css" />
  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="vendor/leaflet.css" />
</head>
<meta charset="utf-8">
  <body>    
    <div id="map">
    </div>

    <div id="chart_container">
      <h2>Area Burned</h2>
      <div id="bar_graph">
      </div>
    </div>

    <script src="vendor/d3.js"></script>
    <script src="vendor/zepto.js"></script>
    <script src="vendor/leaflet.js"></script>
    <script src="vendor/lodash.js"></script>
    <script>
      var fireStyle = {
        color: '#DB4C14',
        weight: '1',
        opacity: '0.8'
      }

      var capitalize = function(str) {
        return str.charAt(0).toUpperCase() + str.slice(1, str.length).toLowerCase();
      }

      var getYear = function(d){
        var date = d.properties.STARTDATE === null ? d.properties.ENDDATE : d.properties.STARTDATE;
        return date.substr(0,4);
      }

      var map = L.map('map').setView([40.0350, -105.27], 11);
      L.tileLayer('http://{s}.tile.cloudmade.com/53725ac327344cb99d13b7a0992c928b/22677/256/{z}/{x}/{y}.png')
        .addTo(map);

      d3.json('boulder_wildfires.geojson', function(error, json) {
        L.geoJson(json, {
          style: fireStyle
        }).addTo(map);

        var years = {}
        for (var i in json.features){
          var feature = json.features[i];
          var year = getYear(feature);
          if (years[year] === undefined) {
            years[year] = 0
          }

          years[year] += feature.properties.Shape_area;
        }

        var w = 500;
        var h = 100;
        var barPadding = 2;
        var areaBurned = _.map(_.pairs(years), function(d) { return d[1] })
        var y = d3.scale.linear().domain([0, d3.max(areaBurned)]).range([0, 110]);

        // Create SVG element
        var svg = d3.select("#bar_graph")
          .append("svg")
          .attr("width", w)
          .attr("height", h + 20);

        svg.selectAll("rect")
          .data(_.pairs(years))
          .enter()
          .append("rect")
          .attr("x", function(d, i) { return i*(w/_.pairs(years).length); })
          .attr("y", function(d) { return h - y(d[1]) } )
          .attr("width", 20 - barPadding)
          .attr("height", function(d) { return y(d[1]) });

        svg.selectAll("text")
          .data(_.pairs(years))
          .enter()
          .append("text")
          .text(function(d) { return d[0] } )
          .attr('stroke', 'black')
          .attr('x', function(d, i ) { return i*(w/areaBurned.length);})
          .attr('y', h + 20)
      });

    </script>
  </body>
</html>
